Element.addMethods({tip:function(b,a){return new Df.Tip($(b),a)}});Df._TipMixin={_initPars:function($super,a){$super();this.setPars({data:"some sample text for the tool tip",className:"holder",parent:document.body,xOffset:0,yOffset:0,xOffsetPointer:0,yOffsetPointer:0,treatAsMenu:true,sensitive:true,controller:this,eventType:"hover",toggleShowDelay:250,toggleHideDelay:250,fitInPage:true,animate:false,xOrientation:"left",yOrientation:"top",pointerOrientation:"left",iframe:true});this.setPars(a)},_setup:function($super){this.pointer;this.tip;this.holder;this.togglePane;this.tipHeight;this.tipWidth;this.eleHeight;this.eleWidth;this.holderHeight;this.holderWidth;this.pointerHeight;this.pointerWidth;this.elePosTop;this.elePosLeft;this.maxHeight;this.maxWidth;this.offSetTop;this.offsetLeft;this.holder=$(this.pars.parent).e("div","bottom",{className:this.pars.className});this.tip=this.holder.e("div","bottom",{className:"tip"});if(this.pars.pointerOrientation){this.pointer=this.holder.e("div","bottom",{className:this.pointerClassName()})}this.togglePane=new Df.TogglePane(this.holder,{controller:this.pars.controller,iframe:this.pars.iframe,animate:this.pars.animate,treatAsMenu:this.pars.treatAsMenu,eventType:this.pars.eventType,toggleShowDelay:this.pars.toggleShowDelay,toggleHideDelay:this.pars.toggleHideDelay});if(!Object.isUndefined(this.element)){this.setContent(this.pars.data)}this._showObserver();this._positionObserver()},_showObserver:function(){this.holder.observe(":show",function(a){this._show(a);this.holder.style.height=this.tipHeight+"px";this.holder.style.width=this.tipWidth+"px";this.getElement().fire(":position")}.bind(this))},_show:function(a){this.holder.style.display="block";this.setElementDems();try{this.holder.style.height=this.tipHeight+"px"}catch(a){}try{this.holder.style.width=this.tipWidth+"px"}catch(a){}},_positionObserver:function(){this.element.observe(":position",function(a){this._position(a)}.bind(this))},_position:function(a){a.stop();try{if(this.holder.style.display=="block"){this.setPos();this.positionTip();if(this.pars.pointerOrientation){this.positionPointer()}if(this.pars.fitInPage){this.adjustToPage()}}}catch(a){}},setContent:function(a){this.holder.style.display="block";this.holder.style.visibility="hidden";this.tip.update(a);this.setDems();this.setPos();this.holder.style.display="none";this.holder.style.visibility="visible";return this},setElementDems:function(){this.eleHeight=parseInt(this.element.getDimensions().height);this.eleWidth=parseInt(this.element.getDimensions().width)},setDems:function(){this.tipHeight=parseInt(this.tip.getDimensions().height);this.tipWidth=parseInt(this.tip.getDimensions().width);this.setElementDems();this.holderHeight=parseInt(this.holder.getDimensions().height);this.holderWidth=parseInt(this.holder.getDimensions().width);if(this.pars.pointerOrientation){this.pointerHeight=parseInt(this.pointer.getDimensions().height);this.pointerWidth=parseInt(this.pointer.getDimensions().width)}},setPos:function(){this.elePosLeft=this.element.cumulativeOffset().left;this.elePosTop=this.element.cumulativeOffset().top;if(this.pars.parent!=document.body){this.elePosLeft-=this.pars.parent.cumulativeOffset().left;this.elePosTop-=this.pars.parent.cumulativeOffset().top}this.maxHeight=parseInt(Element.getDimensions(document.body).height);this.maxWidth=parseInt(Element.getDimensions(document.body).width);this.offSetTop=parseInt(Position.realOffset(this.holder)[1]);this.offsetLeft=parseInt(Position.realOffset(this.holder)[0])},pointerClassName:function(){var a="pointer";if(this.pars.yOrientation=="top"&&this.pars.pointerOrientation=="top"){a+="T"}else{if(this.pars.xOrientation=="left"&&this.pars.pointerOrientation!=="bottom"){a+="L"}else{if(this.pars.xOrientation=="right"&&this.pars.pointerOrientation!=="bottom"){a+="R"}else{a+="B"}}}return a},positionTip:function(){if(this.pars.xOrientation=="right"){this.holder.style.left=this.elePosLeft+this.eleWidth+this.pars.xOffset+"px"}else{if(this.pars.xOrientation=="left"){this.holder.style.left=this.elePosLeft-this.holderWidth-this.pars.xOffset+"px"}else{if(this.pars.xOrientation=="center"){this.holder.style.left=this.elePosLeft-(this.holderWidth/2)+((this.eleWidth)/2)+this.pars.xOffset+"px"}}}if(this.pars.yOrientation=="top"){this.holder.style.top=this.elePosTop-this.tipHeight-this.pars.yOffset+"px"}else{if(this.pars.yOrientation=="bottom"){this.holder.style.top=this.elePosTop+this.eleHeight+this.pars.yOffset+"px"}else{if(this.pars.yOrientation=="center"){this.holder.style.top=this.elePosTop+((this.eleHeight/2)-(this.tipHeight/2))+this.pars.yOffset+"px"}}}},positionPointer:function(){this.pointer.style.display="block";this.pointer.style.top="0px";this.pointer.style.left="0px";if(this.pars.xOrientation=="left"&&this.pars.yOrientation=="top"){if(this.pars.pointerOrientation=="left"){this.pointerLeft();this.pointerSunkenTop()}else{if(this.pars.pointerOrientation=="top"){this.pointerTop();this.pointerSunkenLeft()}}}else{if(this.pars.xOrientation=="center"&&this.pars.yOrientation=="top"){this.pointerTop();this.pointerCenterX()}else{if(this.pars.xOrientation=="right"&&this.pars.yOrientation=="top"){if(this.pars.pointerOrientation=="right"){this.pointerRight();this.pointerSunkenTop()}else{if(this.pars.pointerOrientation=="top"){this.pointerTop();this.pointerSunkenRight()}}}else{if(this.pars.xOrientation=="left"&&this.pars.yOrientation=="center"){this.pointerLeft();this.pointerCenterY()}else{if(this.pars.xOrientation=="right"&&this.pars.yOrientation=="center"){this.pointerRight();this.pointerCenterY()}else{if(this.pars.xOrientation=="right"&&this.pars.yOrientation=="bottom"){if(this.pars.pointerOrientation=="right"){this.pointerRight();this.pointerSunkenBottom()}else{if(this.pars.pointerOrientation=="bottom"){this.pointerBottom();this.pointerSunkenRight()}}}else{if(this.pars.xOrientation=="center"&&this.pars.yOrientation=="bottom"){this.pointerBottom();this.pointerCenterX()}else{if(this.pars.xOrientation=="left"&&this.pars.yOrientation=="bottom"){if(this.pars.pointerOrientation=="left"){this.pointerLeft();this.pointerSunkenBottom()}else{if(this.pars.pointerOrientation=="bottom"){this.pointerBottom();this.pointerSunkenLeft()}}}}}}}}}}},pointerTop:function(){try{this.holder.style.height=this.tipHeight+this.pointerHeight+this.pars.yOffsetPointer+"px"}catch(a){}this.holder.style.top=parseInt(this.holder.style.top)-this.pointerHeight+-this.pars.yOffsetPointer+"px";this.pointer.style.top=this.tipHeight+this.pars.yOffsetPointer+"px"},pointerBottom:function(){this.holder.style.height=this.tipHeight+this.pointerHeight+this.pars.yOffsetPointer+"px";this.tip.style.top=this.pointerHeight+this.pars.yOffsetPointer+"px"},pointerSunkenTop:function(){this.holder.style.top=parseInt(this.holder.style.top)+this.pointerHeight-this.pars.yOffsetPointer+"px";this.pointer.style.top=this.tipHeight-this.pointerHeight+this.pars.yOffsetPointer+"px"},pointerSunkenBottom:function(){this.holder.style.top=parseInt(this.holder.style.top)-this.pointerHeight+this.pars.yOffsetPointer+"px";this.pointer.style.top=-this.pars.yOffsetPointer+"px"},pointerSunkenLeft:function(){this.holder.style.left=parseInt(this.holder.style.left)+this.pointerWidth-this.pars.xOffsetPointer+"px";this.pointer.style.left=this.holderWidth-this.pointerWidth+this.pars.xOffsetPointer+"px"},pointerSunkenRight:function(){this.holder.style.left=parseInt(this.holder.style.left)-this.pointerWidth+this.pars.xOffsetPointer+"px";this.pointer.style.left=-this.pars.xOffsetPointer+"px"},pointerHolderWidth:function(){this.holder.style.width=this.holderWidth+this.pointerWidth+this.pars.xOffsetPointer+"px"},pointerLeft:function(){this.pointerHolderWidth();this.holder.style.left=parseInt(this.holder.style.left)-this.pointerWidth-this.pars.xOffsetPointer+"px";this.pointer.style.left=this.tipWidth+this.pars.xOffsetPointer+"px"},pointerRight:function(){this.pointerHolderWidth();this.tip.style.left=this.pointerWidth+this.pars.xOffsetPointer+"px"},pointerCenterX:function(){this.pointer.style.left=(parseInt(this.holder.style.width)/2)-(this.pointerWidth/2)+"px"},pointerCenterY:function(){this.pointer.style.top=(this.tipHeight/2)-(this.pointerHeight/2)+"px"},resizeHolderWithoutPointer:function(){this.holder.style.height=this.tipHeight+"px";this.holder.style.width=this.tipWidth+"px";this.tip.style.top="0px";this.tip.style.left="0px";this.pointer.style.display="none"},adjustToPage:function(){var c=-1*(parseInt(this.holder.style.top)-this.offSetTop);var a=(parseInt(this.holder.style.height)+parseInt(this.holder.style.top)-this.offSetTop)-this.maxHeight;var b=-1*(parseInt(this.holder.style.left)-this.offsetLeft);var d=(parseInt(this.holder.style.width)+parseInt(this.holder.style.left)-this.offsetLeft)-this.maxWidth;if(this.pars.pointerOrientation){if(((c>0|a>0)&&(b>0|d>0))|(c>0&&(this.pars.xOrientation=="center"|this.pars.pointerOrientation=="top"))|(a>0&&(this.pars.xOrientation=="center"|this.pars.pointerOrientation=="bottom"))|(b>0&&(this.pars.yOrientation=="center"|this.pars.pointerOrientation=="left"))|(d>0&&(this.pars.yOrientation=="center"|this.pars.pointerOrientation=="right"))){this.resizeHolderWithoutPointer()}}if(c>0){this.holder.style.top=parseInt(this.holder.style.top)+c+"px";if(this.pars.pointerOrientation){this.pointer.style.top=parseInt(this.pointer.getStyle("top"))-c+"px"}}else{if(a>0){this.holder.style.top=parseInt(this.holder.style.top)-a+"px";if(this.pars.pointerOrientation){this.pointer.style.top=parseInt(this.pointer.getStyle("top"))+a+"px"}}}if(b>0){this.holder.style.left=parseInt(this.holder.style.left)+b+"px";if(this.pars.pointerOrientation){this.pointer.style.left=parseInt(this.pointer.getStyle("left"))-b+"px"}}else{if(d>0){this.holder.style.left=parseInt(this.holder.style.left)-d+"px";if(this.pars.pointerOrientation){this.pointer.style.left=parseInt(this.pointer.getStyle("left"))+d+"px"}}}},addController:function(a){this.togglePane.addController(a);return this},removeController:function(a){this.togglePane.removeController(a);return this}};Df.Tip=Class.create(Df.Element);Df.Tip.addMethods(Df._TipMixin);Df.NewTip=Class.create(Df.Base);Df.NewTip.addMethods(Df._TipMixin);Df.NewTip.addMethods({initialize:function($super,a){$super(a);this._setup();return this},_showObserver:function(){this.holder.observe(":show",function(a){this.setContent();this._show(a);this.holder.fire(":position")}.bind(this));this.holder.observe(":controllerChange",function(a){this.setContent.bind(this).defer()}.bind(this))},setContent:function(){this.holder.style.display="block";this.holder.style.visibility="hidden";this.tip.update(this.pars.data);this.setDems();this.setPos();this.holder.style.display="none";this.holder.style.visibility="visible";return this},_positionObserver:function(){this.holder.observe(":position",function(a){this._position(a)}.bind(this))}});ess.checkout=ess.checkout||{};document.observe("dom:loaded",function(c){ess.checkout.updateState=function(d,h,e){var g=h.replace(".country",".state");if(ess.countries[d]){var f=ess.countries[d].state.fieldtype;if(f=="selectoption"){ess.checkout.makeselectfield(d,g,e)}else{ess.checkout.maketextfield(d,g,e)}}else{ess.checkout.maketextfield(d,g,e)}};ess.checkout.makeselectfield=function(d,f,e){StoreCountryService.getStates(d,function(i){var m=$(f);var s=m.positionedOffset()[0];var r=m.positionedOffset()[1];var p=m.getDimensions()["width"];var n=m.getDimensions()["height"];var t="left:"+s+"px;top:"+r+"px;width:"+p+"px;height:"+n+"px;";var q=new Element("span",{"class":"loader",style:t});var l=null;m.up().insert(q);l=i;var g=i.length;var h=null;h=new Element("select",{name:f,id:f,tabindex:"1"});h.insert('<option value=""></option>');for(var k=0;k<i.length;k++){var o=i[k].code;h.insert('<option value="'+i[k].code+'">'+o+"</option>")}m.replace(h);if($(f+"AlternateText")){$(f+"AlternateText").remove()}if(e){ess.checkout.updateStateSelectValue(e,f)}else{$(f).selectedIndex=0}q.remove()})};ess.checkout.maketextfield=function(d,g,e){newStateField=new Element("input",{type:"hidden",name:g,id:g,tabindex:"1",value:"Other"});if(e){billingAddressStateAlternateText=e}else{if(ess.addressBook.billingAddressId!="0"&&ess.addressBook.billingAddressId!=""&&ess.addressBook.getAddress(ess.addressBook.billingAddressId)){billingAddressStateAlternateText=ess.addressBook.getAddress(ess.addressBook.billingAddressId).stateAlternateText}else{billingAddressStateAlternateText=""}}newStateAlternateTextField=new Element("input",{type:"text","class":"text",name:g+"AlternateText",id:g+"AlternateText",tabindex:"1",value:billingAddressStateAlternateText,maxlength:"20"});var f=$(g);f.replace(newStateField);if($(g+"AlternateText")){$(g+"AlternateText").remove()}newStateField.insert({after:newStateAlternateTextField})};ess.checkout.updateStateSelectValue=function(e,d){stateFieldObj=$(d);stateFieldObj.select("option").each(function(f){if(f.value==e){f.selected=true}})};ess.checkout.updateAddressFields=function(g){selectstr=g+".address.country";var n=$(selectstr).value;var o=false;if(!Object.isUndefined(ess.countries[n])){o=ess.countries[n]}else{o=ess.countries.International}for(var e in o){var d=g+"-"+e;d=d.toString();var h=o[e].label;var f=o[e].visibility;if(f=="hidden"){newdisplay="none"}else{newdisplay="block"}if($(d)){$(d).setStyle({visibility:f,display:newdisplay});if(o[e].required){var l=new Element("span",{"class":"required"});l.update("*");$(d).firstDescendant().update(l);$(d).firstDescendant().insert(" "+h)}else{$(d).firstDescendant().update(h)}}}if(ess.availableShippingCountries){if(g=="billingAddress"&&$("shipOption1")&&$("shipOption2")){if($("shipOption3")&&$("shipOption3").checked){}else{var m=false;var k=ess.availableShippingCountries.split(",");for(var j=0;j<k.length;j++){if(k[j]==n){m=true;break}}if(!m){$("shipOption1").disabled=true;if($("shipOption1").checked){ess.addressBook.setMultiShipTo(false);ess.addressBook.setShippingAddressId("")}}else{$("shipOption1").disabled=false}}}}};ess.checkout.doLink=function(d){$("linkForm_eventId").value=d;$("linkForm").submit()};ess.checkout.toggleButton=function(d){$(d).toggle()};ess.checkout.editShippingAddress=function(d){$("linkForm").insert(new Element("input",{type:"hidden",name:"edit",value:d}));ess.checkout.doLink("editShippingAddress")};var b=/MSIE (\d+\.\d+);/.test(navigator.userAgent);if(b==false){var a=$("addresses").getHeight()}if($$(".toggle-link")[0]){$$(".toggle-link")[0].observe("click",function(){if(b){$("addresses").style.cssText="display: none; margin-bottom: 5px;"}else{new Df.Animate($("addresses")).run({height:"5px",ease:Df.Transitions.linear})}this.addClassName("hide");$$(".toggle-link")[1].removeClassName("hide")})}if($$(".toggle-link")[1]){$$(".toggle-link")[1].observe("click",function(){if(b){$("addresses").style.cssText="display: block; margin-bottom: 0;"}else{new Df.Animate($("addresses")).run({height:a+"px",ease:Df.Transitions.linear})}this.addClassName("hide");$$(".toggle-link")[0].removeClassName("hide")})}if(($$("body#address-book").length>0)&&($("addresses"))){if(b){$("addresses").style.cssText="display: none;"}else{$("addresses").style.cssText="height: 0px;"}}});defaultAnimation=function(a){this.domElement=$(a);this.ins=new Df.Animate(this.domElement);this.hide=function(){if(!this.domElement.hasClassName("collapsed")){this.domElement.style.height=this.domElement.scrollHeight;if(this.domElement.hasClassName("expanded")){this.domElement.removeClassName("expanded")}this.ins.pars.time=100;this.ins.pars.height=1;this.ins.pars.domElement=this.domElement;this.ins.pars.onComplete=function(){this.onComplete=false;this.height=1;this.opacity=0;this.domElement.addClassName("collapsed")};this.ins.run()}};this.show=function(){if(this.domElement.hasClassName("collapsed")){this.domElement.style.height="1px";this.domElement.style.overflow="hidden";this.domElement.removeClassName("collapsed");this.ins.pars.time=100;this.ins.pars.height=this.domElement.scrollHeight;this.ins.pars.domElement=this.domElement;this.ins.pars.onComplete=function(){this.onComplete=false;this.opacity=0.99;if(!this.domElement.hasClassName("expanded")){this.domElement.addClassName("expanded");this.domElement.style.overflow="visible"}};this.ins.run()}}};function checkRequired(b){if("object"!=typeof(b)){return false}var f=true;var e=false;var c="Please enter values for all required fields.";var d="Invalid Characters: *";var g="Please enter a postal code with either 5 numbers or 9 numbers separated by a dash. Example: 12345 or 12345-1234.";var a=["96","127",{range:"1-31,166-255"}];b.each(function(k,j){var p=k.getValue();var m=true;if(true==p.blank()&&!k.readAttribute("id").match(/address2/)){m=false}else{var o=p.matchAscii(a);var n=k.readAttribute("id")+"_error";var l=$(n);if(o){if(!l){k.insert({after:new Element("p",{className:"fieldErrorMessages",id:n}).update(d.replace("*",o))})}else{l.update(d.replace("*",o))}m=false}else{if("shippingAddress.address.postalCode"==k.readAttribute("id")){if(!p.match(/^\d{5}-\d{4}$/)&&!p.match(/^\d{5}$/)){m=false;if(!l){k.insert({after:new Element("p",{className:"fieldErrorMessages",id:n}).update(g)})}else{l.update(g)}}else{if(l){l.remove()}}}else{if(l){l.remove()}}}}if(!e&&!m){k.focus();e=true}if($("addressBookForm")){fieldParent=$("shippingAddress")||$("shipOpt")}else{if(k.descendantOf("billingAddress")){fieldParent=$$("#billingAddress .section")[0]}else{if(k.descendantOf("shipping-address")){fieldParent=$("shipping-address-content")}}}if(!m){k.addClassName("fieldError");f=false}else{k.removeClassName("fieldError")}if(!f){if(!fieldParent.select(".insertedError")[0]){fieldParent.insert({top:new Element("p",{className:"fieldErrorMessages insertedError"}).update(c)})}}else{var h=fieldParent.select(".insertedError")[0];if(h){h.remove()}}});return f}document.observe("dom:loaded",function(a){$A($$("span.tooltip")).each(function(b){b.removeClassName("hide")});$A($$("a.close-tip")).each(function(b){b.writeAttribute("onclick","return false")});$A($$("a.tooltip")).each(function(b){b.writeAttribute("href","Javascript:void(0);");b.writeAttribute("onclick","return false");var e=null;if($(b).up().next()&&$(b).up().next().className=="tooltip"){e=$(b).up().next()}else{if($(b).next()&&$(b).next().className=="tooltip"){e=$(b).next()}}var d={data:e,eventType:"click",treatAsMenu:false,sensitive:true,xOffset:5,yOffset:-3,yOffsetPointer:-1,xOffsetPointer:-32,pointerOrientation:"top",xOrientation:"right",yOrientation:"top",toggleShowDelay:0,toggleHideDelay:0,animate:{opacity:0.9,time:500,pause:20}};if(e!=null){var c=new Df.Tip(b,d);e.select("a.close-tip").each(function(f){f.observe("click",function(g){this.up(2).hide();c.togglePane.hide()})})}})});ess.address={};ess.address.formatAddress=function(d,a,c){var e=new ZParse(Implementation);e.parse(a.innerHTML);var b=e.process({firstName:d.firstName,lastName:d.lastName,address1:d.address1,address2:d.address2,address3:d.address3,city:d.city,state:d.state,stateAlternateText:d.stateAlternateText,postalCode:d.postalCode,country:d.fullCountryName});c.update(b)};ess.address.formatAddressSuggestion=function(f,a,d){var g=new ZParse(Implementation);g.parse(a.innerHTML);try{var b=g.process({address1:f.address1,address1Error:f.address1Error,address2:f.address2,address2Error:f.address2Error,address3:f.address3,address3Error:f.address3Error,city:f.city,cityError:f.cityError,state:f.state,stateError:f.stateError,stateAlternateText:f.stateAlternateText,stateAlternateTextError:f.stateAlternateTextError,postalCode:f.postalCode,postalCodeError:f.postalCodeError,country:f.fullCountryName,countryError:f.fullCountryNameError})}catch(c){}d.update(b)};AddressBook=function(a){this.billingAddressId=a.billingAddressId;this.shippingAddressId=a.shippingAddressId;this.addresses=a.addresses;this.billingAddressUpdateListeners=[];this.shippingAddressUpdateListeners=[];this.updateListeners=[];this.multiShipTo=a.multiShipTo;if(a.preferredBillingAddressId){this.preferredBillingAddressId=a.preferredBillingAddressId}if(a.preferredShippingAddressId){this.preferredShippingAddressId=a.preferredShippingAddressId}this.addBillingAddressUpdateListener=function(b){this.billingAddressUpdateListeners.push(b)};this.addShippingAddressUpdateListener=function(b){this.shippingAddressUpdateListeners.push(b)};this.addUpdateListener=function(b){this.updateListeners.push(b)};this.setMultiShipTo=function(b){this.multiShipTo=b};this.setBillingAddressId=function(b){this.billingAddressId=b;for(var c=0;c<this.billingAddressUpdateListeners.length;c++){this.billingAddressUpdateListeners[c].observeBillingAddressUpdate(this)}this.updated()};this.setShippingAddressId=function(b){this.shippingAddressId=b;for(var c=0;c<this.shippingAddressUpdateListeners.length;c++){this.shippingAddressUpdateListeners[c].observeShippingAddressUpdate(this)}this.updated()};this.updated=function(){for(var b=0;b<this.updateListeners.length;b++){this.updateListeners[b].observeAddressBookUpdate(this)}};this.getAddress=function(b){for(var c=0;c<this.addresses.length;c++){if(this.addresses[c].id==b){return this.addresses[c]}}return null}};Address=function(a){this.addresses=a.addresses;this.getAddress=function(b){for(var c=0;c<this.addresses.length;c++){if(this.addresses[c].id==b){return this.addresses[c]}}return null}};